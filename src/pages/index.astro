---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import "../style/global.css";
import "../style/darkMode.css";

// Componentes
import HeroSection from '../components/HeroSection.astro';
import ProjectsSection from '../components/ProjectsSection.astro';
import SkillsSection from '../components/SkillsSection.astro';
import AboutSection from '../components/AboutSection.astro';
import ContactSection from '../components/ContactSection.astro';
import Navbar from '../components/Navbar.astro';
import ThemeLanguageSelector from '../components/ThemeLanguageSelector.astro';
import ClientScripts from '../components/ClientScripts.astro';

// No importar el script aquí, usarlo con client:load
---

<Layout title="Portafolio | Desarrollador Full Stack">
  <Navbar />
  
  <main class="w-full bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Hero Section con animación de texto -->
    <section id="hero-section" class="section-container w-full">
      <HeroSection />
    </section>
   
    <!-- Sección Sobre Mí -->
    <section id="about" class="section-container w-full">
      <AboutSection />
    </section>

    <!-- Sección de Habilidades -->
    <section id="skills" class="section-container w-full">
      <SkillsSection />
    </section>
    
   <section id="projects" class="section-container w-full">
    <ProjectsSection />
   </section>
    
    <!-- Sección de Contacto -->
    <section id="contact" class="section-container w-full">
      <ContactSection />
    </section>
  </main>
  
  <!-- Selector de tema y lenguaje -->
  <ThemeLanguageSelector />
  
  <!-- Scripts del cliente (cargados al final) -->
  <ClientScripts />
  
  <script is:inline>
    // Definir la función de cambio de idioma de manera global inmediatamente
    window.changeLanguage = function(lang) {
      console.log('Cambiando idioma a: ' + lang);
      
      // Traducciones disponibles
      const translations = {
        'es': {
          'home': 'Inicio',
          'about': 'Sobre Mí',
          'skills': 'Habilidades',
          'projects': 'Proyectos',
          'contact': 'Contacto',
          'hero-title': '¡Hola Mundo! Soy',
          'hero-subtitle': 'Desarrollador Fullstack',
          'hero-description': 'Transformando ideas en soluciones digitales con código limpio y diseños creativos.',
          'contact-me': 'Contáctame',
          'view-projects': 'Ver Proyectos',
          'download-cv': 'Descargar CV',
          'about-title': 'Sobre Mí',
          'skills-title': 'Mis Habilidades',
          'projects-title': 'Proyectos Destacados',
          'view-project': 'Ver Proyecto',
          'source-code': 'Código Fuente',
          'all-projects': 'Ver Todos',
          'form-name': 'Nombre',
          'form-email': 'Correo Electrónico',
          'form-message': 'Mensaje',
          'form-submit': 'Enviar Mensaje',
          'frontend': 'Frontend',
          'backend': 'Backend',
          'tools': 'Herramientas',
          'frameworks': 'Frameworks',
          'portfolio': 'Portfolio',
          'projects-description': 'Explora algunos de mis proyectos recientes. Cada proyecto es único y resuelve problemas específicos de negocio utilizando las tecnologías más adecuadas.',
          'view-all-projects': 'Ver todos los proyectos',
          'skills-description': 'Herramientas y tecnologías con las que he trabajado para crear soluciones digitales eficientes e innovadoras.',
          'about-greeting': '¡Hola! Soy Juan José',
          'about-description': 'Como desarrollador Fullstack, me especializo en crear soluciones digitales completas que combinan diseño atractivo con código limpio y eficiente. Mi enfoque está en desarrollar aplicaciones que no solo se vean bien, sino que también ofrezcan experiencias de usuario excepcionales y escalabilidad para crecer con tu negocio.',
          'education': 'Educación',
          'education-degree': 'Ingeniería Informatica',
          'education-school': 'Institucion Universitaria de Envigado',
          'location-title': 'Ubicación',
          'location-city': 'Envigado, Colombia',
          'location-remote': 'Disponible para trabajo remoto',
          'experience': 'Experiencia',
          'experience-years': '2+ años en desarrollo web y móvil',
          'experience-skills': 'Frontend, Backend y Diseño UI/UX',
          'specialties': 'Especialidades',
          'specialties-tech': 'React, Node.js, UI/UX, Astro, TailwindCSS',
          'specialties-focus': 'Soluciones web modernas y responsivas',
          'stats-projects': 'Proyectos completados',
          'stats-clients': 'Clientes satisfechos',
          'stats-experience': 'Años de experiencia',
          'stats-coffee': 'Tazas de café',
          'contact-title': 'Contáctame',
          'contact-description': '¿Tienes un proyecto en mente? ¡Hablemos sobre cómo puedo ayudarte a hacerlo realidad! Estoy disponible para trabajos freelance, colaboraciones o simplemente para charlar sobre tecnología.',
          'contact-info': 'Información de Contacto',
          'email-label': 'Email',
          'phone': 'Teléfono',
          'location-title': 'Ubicación',
          'follow-me': 'Sígueme',
          'send-message': 'Envíame un mensaje',
          'subject': 'Asunto',
          'pos-system-title': 'Sistema POS',
          'hotel-system-title': 'Sistema de Hotel',
          'parking-crud-title': 'CRUD de Parqueadero',
          'ecommerce-title': 'Plataforma E-commerce',
          'dashboard-title': 'Dashboard Analítico',
          'management-app-title': 'App de Gestión',
          'pos-system-description': 'Sistema de punto de venta con gestión de inventario, ventas e informes.',
          'hotel-system-description': 'Aplicación para gestión de reservas, pagos y clientes de hotel.',
          'parking-crud-description': 'Sistema para administración de parqueaderos con registro y pagos de vehículos.',
          'ecommerce-description': 'Plataforma completa con carrito de compras, pagos y panel administrativo.',
          'dashboard-description': 'Dashboard interactivo para visualización de datos empresariales en tiempo real.',
          'management-app-description': 'Aplicación para gestión de recursos y proyectos empresariales.'
        },
        'en': {
          'home': 'Home',
          'about': 'About Me',
          'skills': 'Skills',
          'projects': 'Projects',
          'contact': 'Contact',
          'hero-title': 'Hello World! I am',
          'hero-subtitle': 'Fullstack Developer',
          'hero-description': 'Transforming ideas into digital solutions with clean code and creative designs.',
          'contact-me': 'Contact Me',
          'view-projects': 'View Projects',
          'download-cv': 'Download CV',
          'about-title': 'About Me',
          'skills-title': 'My Skills',
          'projects-title': 'Featured Projects',
          'view-project': 'View Project',
          'source-code': 'Source Code',
          'all-projects': 'View All',
          'form-name': 'Name',
          'form-email': 'Email',
          'form-message': 'Message',
          'form-submit': 'Send Message',
          'frontend': 'Frontend',
          'backend': 'Backend',
          'tools': 'Tools',
          'frameworks': 'Frameworks',
          'portfolio': 'Portfolio',
          'projects-description': 'Explore some of my recent projects. Each project is unique and solves specific business problems using the most appropriate technologies.',
          'view-all-projects': 'View all projects',
          'skills-description': 'Tools and technologies I have worked with to create efficient and innovative digital solutions.',
          'about-greeting': 'Hello! I am Juan José',
          'about-description': 'As a Fullstack developer, I specialize in creating complete digital solutions that combine attractive design with clean and efficient code. My focus is on developing applications that not only look good, but also offer exceptional user experiences and scalability to grow with your business.',
          'education': 'Education',
          'education-degree': 'Computer Engineering',
          'education-school': 'Institucion Universitaria de Envigado',
          'location-title': 'Location',
          'location-city': 'Envigado, Colombia',
          'location-remote': 'Available for remote work',
          'experience': 'Experience',
          'experience-years': '2+ years in web and mobile development',
          'experience-skills': 'Frontend, Backend and UI/UX Design',
          'specialties': 'Specialties',
          'specialties-tech': 'React, Node.js, UI/UX, Astro, TailwindCSS',
          'specialties-focus': 'Modern and responsive web solutions',
          'stats-projects': 'Completed projects',
          'stats-clients': 'Satisfied clients',
          'stats-experience': 'Years of experience',
          'stats-coffee': 'Cups of coffee',
          'contact-title': 'Contact Me',
          'contact-description': 'Do you have a project in mind? Let\'s talk about how I can help you make it happen! I am available for freelance work, collaborations or just to chat about technology.',
          'contact-info': 'Contact Information',
          'email-label': 'Email',
          'phone': 'Phone',
          'location-title': 'Location',
          'follow-me': 'Follow Me',
          'send-message': 'Send Me a Message',
          'subject': 'Subject',
          'pos-system-title': 'POS System',
          'hotel-system-title': 'Hotel System',
          'parking-crud-title': 'Parking CRUD',
          'ecommerce-title': 'E-commerce Platform',
          'dashboard-title': 'Analytics Dashboard',
          'management-app-title': 'Management App',
          'pos-system-description': 'Point of sale system with inventory management, sales and reports.',
          'hotel-system-description': 'Application for managing hotel reservations, payments and customers.',
          'parking-crud-description': 'System for parking management with vehicle registration and payments.',
          'ecommerce-description': 'Complete platform with shopping cart, payments and admin panel.',
          'dashboard-description': 'Interactive dashboard for real-time business data visualization.',
          'management-app-description': 'Application for business resource and project management.'
        }
      };
      
      // Hacer las traducciones disponibles globalmente
      window.translations = translations;
      
      // Guardar preferencia
      localStorage.setItem('language', lang);
      document.documentElement.lang = lang;
      
      // Traducir todos los elementos con data-i18n
      document.querySelectorAll('[data-i18n]').forEach(function(element) {
        const key = element.getAttribute('data-i18n');
        if (key && translations[lang] && translations[lang][key]) {
          // No actualizar el texto del botón de idioma desde aquí
          if (element.id !== 'current-lang') {
            element.textContent = translations[lang][key];
          }
        }
      });
      
      // Buscar todos los atributos placeholder con data-i18n-placeholder
      document.querySelectorAll('[data-i18n-placeholder]').forEach(function(element) {
        const key = element.getAttribute('data-i18n-placeholder');
        if (key && translations[lang] && translations[lang][key]) {
          element.setAttribute('placeholder', translations[lang][key]);
        }
      });
      
      // Actualizar el selector de idioma
      const langBtn = document.getElementById('current-lang');
      if (langBtn) {
        langBtn.textContent = lang.toUpperCase();
      }

      // Emitir evento para componentes que necesiten saber que cambió el idioma
      document.dispatchEvent(new CustomEvent('language-changed', {
        detail: { language: lang }
      }));
      
      // Aplicar la traducción también a elementos específicos que podrían no tener data-i18n
      const specificElements = {
        // Agregar aquí elementos específicos que necesiten traducción personalizada
        // Ejemplo: document.querySelector('.navbar-brand').textContent = translations[lang]['brand-name'];
      };
      
      // Actualizar meta tags, titles, etc.
      document.title = lang === 'es' ? 'Portfolio de Juan José - Desarrollador Fullstack' : 'Juan José\'s Portfolio - Fullstack Developer';

      console.log('Idioma cambiado exitosamente a ' + lang);
    };

    // Función para asegurar que todas las secciones sean visibles
    function ensureComponentsVisible() {
      // Asegurar que las secciones sean visibles
      const sections = ['skills-component', 'projects-component', 'about-component', 'contact-component'];
      sections.forEach(function(id) {
        const element = document.getElementById(id);
        if (element) {
          element.style.display = 'block';
          element.style.visibility = 'visible';
          element.style.opacity = '1';
        }
      });
      
      // Buscar y corregir elementos con overflow que puedan causar scrollbars adicionales
      const containers = document.querySelectorAll('main, .container, section');
      containers.forEach(el => {
        if (el) {
          el.style.overflow = 'visible';
        }
      });
    }
    
    // Ejecutar tan pronto como sea posible
    ensureComponentsVisible();
    
    // Ejecutar al cargar el DOM
    document.addEventListener('DOMContentLoaded', function() {
      ensureComponentsVisible();
      
      // Inicializar el idioma
      const storedLang = localStorage.getItem('language') || 'es';
      if (window.changeLanguage) {
        window.changeLanguage(storedLang);
      }
      
      // Aplicar tema según preferencia guardada
      const storedTheme = localStorage.getItem('color-theme');
      
      if (storedTheme === 'dark' || 
         (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      
      // Actualizar los iconos del tema
      const darkIcon = document.getElementById('dark-icon');
      const lightIcon = document.getElementById('light-icon');
      
      if (darkIcon && lightIcon) {
        if (document.documentElement.classList.contains('dark')) {
          darkIcon.classList.add('hidden');
          lightIcon.classList.remove('hidden');
        } else {
          darkIcon.classList.remove('hidden');
          lightIcon.classList.add('hidden');
        }
      }
    });
    
    // Como medida adicional, ejecutar también después de un tiempo
    setTimeout(ensureComponentsVisible, 1000);
  </script>
</Layout>

<style>
  /* Estilos para el modo oscuro */
  :root {
    --background-light: #f9fafb;
    --text-light: #111827;
    --background-dark: #1f2937;
    --text-dark: #f9fafb;
    --primary: #10b981; /* Color principal (emerald-500) */
    --primary-dark: #059669; /* emerald-600 */
    --primary-light: #34d399; /* emerald-400 */
    --shadow-color: rgba(0, 0, 0, 0.05);
    --shadow-color-dark: rgba(0, 0, 0, 0.2);
  }

  .dark {
    color-scheme: dark;
  }
  
  /* Asegurar que las secciones sean visibles */
  .section-container {
    display: block !important;
    width: 100% !important;
    overflow: visible !important;
    position: relative !important;
    height: auto !important;
    min-height: auto !important;
    z-index: 1 !important;
  }

  @supports (-webkit-touch-callout: none) {
    .ios-momentum-scroll {
      -webkit-overflow-scrolling: touch;
    }
  }

  /* Transiciones suaves para cambios de tema */
  @media not all and (min-resolution:.001dpcm) { 
    @supports (-webkit-appearance:none) {
      *, *::before, *::after {
        transition-duration: 0.1s !important;
      }
    }
  }
  
  /* Específico para móviles */
  @media (max-width: 768px) {
    #skills, #projects, #contact {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      min-height: auto !important;
      z-index: 1 !important;
    }
    
    section {
      margin-bottom: 2rem;
    }
  }
  
  /* Forzar un único scrollbar */
  html, body {
    overflow-x: hidden;
  }
  
  html {
    overflow-y: auto;
  }
  
  body {
    overflow-y: visible;
  }
  
  /* Contenedores principales sin overflow */
  main, section, .container {
    overflow: visible !important;
  }
</style>

