---
// Componente que maneja todos los scripts del lado del cliente
---

<script is:inline>
  // Inicializar tema según localStorage o preferencia del sistema
  function initTheme() {
    try {
      const storedTheme = localStorage.getItem('color-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = storedTheme === 'dark' || (!storedTheme && prefersDark);
      
      document.documentElement.classList.toggle('dark', isDark);
      
      // Actualizar iconos
      const darkIcon = document.getElementById("theme-toggle-dark-icon");
      const lightIcon = document.getElementById("theme-toggle-light-icon");
      
      if (darkIcon && lightIcon) {
        darkIcon.classList.toggle('hidden', isDark);
        lightIcon.classList.toggle('hidden', !isDark);
      }
    } catch (e) {
      console.warn('Error inicializando tema:', e);
    }
  }

  // Inicializar idioma según localStorage o preferencia del navegador
  function initLanguage() {
    try {
      const storedLang = localStorage.getItem('language') || 'es';
      document.documentElement.lang = storedLang;

      const currentLanguage = document.getElementById('current-language');
      if (currentLanguage) {
        currentLanguage.textContent = storedLang.toUpperCase();
      }

      // Traducir elementos
      translateElements(storedLang);
      
      // Configurar manejadores de eventos para cambio de idioma
      setupLanguageToggle();
    } catch (e) {
      console.warn('Error inicializando idioma:', e);
    }
  }

  // Función para traducir elementos
  function translateElements(lang) {
    const translations = getTranslations();
    document.querySelectorAll('[data-i18n]').forEach((element) => {
      const key = element.getAttribute('data-i18n');
      if (key && translations[lang] && translations[lang][key]) {
        element.textContent = translations[lang][key];
      }
    });
  }

  // Obtener objeto de traducciones
  function getTranslations() {
    return {
      es: {
        // Navigation
        'home': 'Inicio',
        'about': 'Sobre Mí',
        'skills': 'Habilidades',
        'projects': 'Proyectos',
        'contact': 'Contacto',

        // Hero Section
        'hero-title': '¡Hola Mundo! Soy',
        'hero-subtitle': 'Desarrollador Fullstack',
        'hero-description': 'Transformando ideas en soluciones digitales con código limpio y diseños creativos.',
        'contact-me': 'Contáctame',
        'view-projects': 'Ver Proyectos',

        // About Section
        'about-title': 'Sobre Mí',
        'about-greeting': '¡Hola! Soy Juan José',
        'about-description': 'Como desarrollador Fullstack, me especializo en crear soluciones digitales completas que combinan un diseño atractivo con código limpio y eficiente. Mi enfoque es desarrollar aplicaciones que no solo se vean bien, sino que también ofrezcan experiencias excepcionales al usuario y escalabilidad para crecer con tu negocio.',
        'education': 'Educación',
        'education-degree': 'Ingeniería Informática',
        'education-school': 'Institución Universitaria de Envigado',
        'location-title': 'Ubicación',
        'location-city': 'Envigado, Colombia',
        'location-remote': 'Disponible para trabajo remoto',
        'experience': 'Experiencia',
        'experience-years': '+2 años en desarrollo web y móvil',
        'experience-skills': 'Frontend, Backend y Diseño UI/UX',
        'specialties': 'Especialidades',
        'specialties-tech': 'React, Node.js, UI/UX, Astro, TailwindCSS',
        'specialties-focus': 'Soluciones web modernas y responsivas',
        'download-cv': 'Descargar CV',
        'stats-projects': 'Proyectos Completados',
        'stats-clients': 'Clientes Satisfechos',
        'stats-experience': 'Años de Experiencia',
        'stats-coffee': 'Tazas de Café',

        // Skills Section
        'skills-title': 'Mis Habilidades',
        'skills-description': 'Herramientas y tecnologías con las que he trabajado para crear soluciones digitales eficientes e innovadoras.',

        // Projects Section
        'portfolio': 'Portfolio',
        'projects-title': 'Proyectos Destacados',
        'projects-description': 'Explora algunos de mis proyectos recientes. Cada proyecto es único y resuelve problemas específicos de negocio utilizando las tecnologías más adecuadas.',
        'view-project': 'Ver proyecto',
        'view-all-projects': 'Ver todos los proyectos',

        // Project Titles and Descriptions
        'pos-system-title': 'Sistema POS',
        'pos-system-description': 'Sistema de punto de venta con gestión de inventario, ventas e informes.',
        'hotel-system-title': 'Sistema de Hotel',
        'hotel-system-description': 'Aplicación para gestión de reservas, pagos y clientes de hotel.',
        'parking-crud-title': 'CRUD de Parqueadero',
        'parking-crud-description': 'Sistema para administración de parqueaderos con registro y pagos de vehículos.',
        'ecommerce-title': 'Plataforma E-commerce',
        'ecommerce-description': 'Plataforma completa con carrito de compras, pagos y panel administrativo.',
        'dashboard-title': 'Dashboard Analítico',
        'dashboard-description': 'Dashboard interactivo para visualización de datos empresariales en tiempo real.',
        'management-app-title': 'App de Gestión',
        'management-app-description': 'Aplicación para gestión de recursos y proyectos empresariales.',

        // Contact Section
        'contact-title': 'Contáctame',
        'contact-description': '¿Tienes un proyecto en mente? ¡Hablemos sobre cómo puedo ayudarte a hacerlo realidad! Estoy disponible para trabajos freelance, colaboraciones o simplemente para charlar sobre tecnología.',
        'contact-info': 'Información de Contacto',
        'email-label': 'Email',
        'phone': 'Teléfono',
        'location-title': 'Ubicación',
        'follow-me': 'Sígueme',
        'send-message': 'Envíame un mensaje',
        'name': 'Nombre',
        'subject': 'Asunto',
        'message': 'Mensaje',
        'send': 'Enviar Mensaje',
        'success': '¡Mensaje enviado correctamente!',
        'error': 'Ha ocurrido un error. Inténtalo de nuevo.'
      },
      en: {
        // Navigation
        'home': 'Home',
        'about': 'About Me',
        'skills': 'Skills',
        'projects': 'Projects',
        'contact': 'Contact',

        // Hero Section
        'hero-title': 'Hello World! I am',
        'hero-subtitle': 'Fullstack Developer',
        'hero-description': 'Transforming ideas into digital solutions with clean code and creative designs.',
        'contact-me': 'Contact Me',
        'view-projects': 'View Projects',

        // About Section
        'about-title': 'About Me',
        'about-greeting': 'Hello! I am Juan José',
        'about-description': 'As a Fullstack developer, I specialize in creating complete digital solutions that combine attractive design with clean and efficient code. My focus is on developing applications that not only look good but also offer exceptional user experiences and scalability to grow with your business.',
        'education': 'Education',
        'education-degree': 'Computer Engineering',
        'education-school': 'University Institution of Envigado',
        'location-title': 'Location',
        'location-city': 'Envigado, Colombia',
        'location-remote': 'Available for remote work',
        'experience': 'Experience',
        'experience-years': '2+ years in web and mobile development',
        'experience-skills': 'Frontend, Backend and UI/UX Design',
        'specialties': 'Specialties',
        'specialties-tech': 'React, Node.js, UI/UX, Astro, TailwindCSS',
        'specialties-focus': 'Modern and responsive web solutions',
        'download-cv': 'Download CV',
        'stats-projects': 'Completed Projects',
        'stats-clients': 'Satisfied Clients',
        'stats-experience': 'Years of Experience',
        'stats-coffee': 'Coffee Cups',

        // Skills Section
        'skills-title': 'My Skills',
        'skills-description': 'Tools and technologies I\'ve worked with to create efficient and innovative digital solutions.',

        // Projects Section
        'portfolio': 'Portfolio',
        'projects-title': 'Featured Projects',
        'projects-description': 'Explore some of my recent projects. Each project is unique and solves specific business problems using the most appropriate technologies.',
        'view-project': 'View project',
        'view-all-projects': 'View all projects',

        // Project Titles and Descriptions
        'pos-system-title': 'POS System',
        'pos-system-description': 'Point of Sale system with inventory management, sales, and reporting.',
        'hotel-system-title': 'Hotel System',
        'hotel-system-description': 'Application for managing reservations, payments, and hotel customers.',
        'parking-crud-title': 'Parking CRUD',
        'parking-crud-description': 'System for parking administration with vehicle registration and payments.',
        'ecommerce-title': 'E-commerce Platform',
        'ecommerce-description': 'Complete platform with shopping cart, payments, and admin panel.',
        'dashboard-title': 'Analytics Dashboard',
        'dashboard-description': 'Interactive dashboard for real-time business data visualization.',
        'management-app-title': 'Management App',
        'management-app-description': 'Application for managing business resources and projects.',

        // Contact Section
        'contact-title': 'Contact Me',
        'contact-description': 'Have a project in mind? Let\'s talk about how I can help you make it happen! I\'m available for freelance work, collaborations, or just to chat about technology.',
        'contact-info': 'Contact Information',
        'email-label': 'Email',
        'phone': 'Phone',
        'location-title': 'Location',
        'follow-me': 'Follow Me',
        'send-message': 'Send me a message',
        'name': 'Name',
        'subject': 'Subject',
        'message': 'Message',
        'send': 'Send Message',
        'success': 'Message sent successfully!',
        'error': 'An error occurred. Please try again.'
      }
    };
  }

  // Configurar eventos para cambio de idioma
  function setupLanguageToggle() {
    try {
      const languageToggle = document.getElementById('language-toggle');
      const languageMenu = document.getElementById('language-menu');
      const languageOptions = document.querySelectorAll('.language-option');

      if (languageToggle && languageMenu) {
        // Usar eventos táctiles para mejor soporte móvil
        languageToggle.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          languageMenu.classList.toggle('hidden');
        });
        
        // También manejar eventos táctiles
        languageToggle.addEventListener('touchend', (e) => {
          e.preventDefault();
          e.stopPropagation();
          languageMenu.classList.toggle('hidden');
        }, { passive: false });
      }

      languageOptions.forEach((option) => {
        const setupLangOption = (evt) => {
          evt.preventDefault();
          evt.stopPropagation();
          const target = evt.currentTarget;
          const lang = target.getAttribute('data-lang') || 'es';
          
          // Guardar preferencia y actualizar HTML lang
          localStorage.setItem('language', lang);
          document.documentElement.lang = lang;
          
          // Actualizar texto del selector
          const currentLanguage = document.getElementById('current-language');
          if (currentLanguage) {
            currentLanguage.textContent = lang.toUpperCase();
          }
          
          // Traducir elementos
          translateElements(lang);
          
          // Cerrar menú
          if (languageMenu) {
            languageMenu.classList.add('hidden');
          }
        };
        
        option.addEventListener('click', setupLangOption);
        option.addEventListener('touchend', setupLangOption, { passive: false });
      });

      // Cerrar menú al hacer clic fuera
      document.addEventListener('click', (e) => {
        if (languageMenu && languageToggle && 
            !languageToggle.contains(e.target) && 
            !languageMenu.contains(e.target)) {
          languageMenu.classList.add('hidden');
        }
      });
      
      // También para eventos táctiles
      document.addEventListener('touchend', (e) => {
        if (languageMenu && languageToggle && 
            !languageToggle.contains(e.target) && 
            !languageMenu.contains(e.target)) {
          languageMenu.classList.add('hidden');
        }
      }, { passive: true });
    } catch (e) {
      console.warn('Error configurando eventos de idioma:', e);
    }
  }

  // Configurar eventos para cambio de tema
  function setupThemeToggle() {
    try {
      const themeToggle = document.getElementById("theme-toggle");
      const darkIcon = document.getElementById("theme-toggle-dark-icon");
      const lightIcon = document.getElementById("theme-toggle-light-icon");
    
      if (themeToggle && darkIcon && lightIcon) {
        const toggleTheme = (evt) => {
          evt.preventDefault();
          evt.stopPropagation();
          const isDark = document.documentElement.classList.contains("dark");
          document.documentElement.classList.toggle('dark', !isDark);
          
          localStorage.setItem('color-theme', !isDark ? 'dark' : 'light');
          
          darkIcon.classList.toggle('hidden', !isDark);
          lightIcon.classList.toggle('hidden', isDark);
        };
        
        // Usar eventos táctiles para mejor soporte móvil
        themeToggle.addEventListener("click", toggleTheme);
        themeToggle.addEventListener("touchend", toggleTheme, { passive: false });
      }
    } catch (e) {
      console.warn('Error configurando toggle de tema:', e);
    }
  }

  // Función para manejar animaciones y visibilidad
  function setupAnimations() {
    try {
      // Animaciones para el Hero Section
      const fadeElements = document.querySelectorAll('.name-reveal, .gradient-text, .description-fade-in, .buttons-slide-up');
      fadeElements.forEach((el, index) => {
        setTimeout(() => {
          el.style.opacity = "1";
          el.style.transform = "translateY(0)";
        }, 300 * (index + 1));
      });
      
      // Animación de iconos sociales
      const socialIcons = document.querySelectorAll('.social-icon');
      socialIcons.forEach((icon, index) => {
        setTimeout(() => {
          icon.style.opacity = "1";
          icon.style.transform = "scale(1)";
        }, 500 + (100 * index));
      });
      
      // Animación de imagen de perfil
      const profileImage = document.querySelector('.profile-image-reveal');
      if (profileImage) {
        setTimeout(() => {
          profileImage.style.opacity = "1";
          profileImage.style.transform = "scale(1) rotate(0)";
        }, 300);
      }
      
      // Efecto de escritura para el texto de bienvenida
      const typingText = document.querySelector('.typing-effect');
      if (typingText && typingText.textContent) {
        const text = typingText.textContent;
        typingText.textContent = "";
        let i = 0;
        
        function typeWriter() {
          if (i < text.length) {
            typingText.textContent += text.charAt(i);
            i++;
            setTimeout(typeWriter, 50);
          }
        }
        
        typeWriter();
      }
    } catch (e) {
      console.warn('Error en animaciones:', e);
    }
  }
  
  // Arreglar problemas de scroll y navegación
  function fixMobileScrolling() {
    try {
      // Asegurar que los enlaces suaves funcionen
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          
          const targetId = this.getAttribute('href');
          const targetElement = document.querySelector(targetId);
          
          if (targetElement) {
            // Scroll suave
            targetElement.scrollIntoView({
              behavior: 'smooth'
            });
            
            // También cerrar el menú móvil si está abierto
            const mobileMenu = document.querySelector('.mobile-menu');
            if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
              mobileMenu.classList.add('hidden');
            }
          }
        });
      });
      
      // Específicamente para dispositivos iOS
      if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
        // Asegurar que todos los contenedores scrollables tengan la clase necesaria
        document.querySelectorAll('main, section').forEach(el => {
          el.classList.add('ios-momentum-scroll');
        });
      }
    } catch (e) {
      console.warn('Error al configurar scroll móvil:', e);
    }
  }

  // Inicializar todo
  if (typeof window !== 'undefined' && typeof document !== 'undefined') {
    // Ejecutar inmediatamente para evitar parpadeos
    initTheme();
    
    // El resto después de que el DOM esté listo
    document.addEventListener('DOMContentLoaded', () => {
      initLanguage();
      setupThemeToggle();
      setupAnimations();
      fixMobileScrolling();
      
      // Forzar una actualización del DOM para resolver problemas de renderizado
      setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
      }, 100);
    });
  }
</script> 